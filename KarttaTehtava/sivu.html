<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Pyörä Kartta</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js"></script>
</head>

<body>

    <h1>Kaupunkipyörät!</h1>
    <select name="lista" id="asemat" onchange="testi(this);">
        <option value="empty"></option>
    </select>

    <div id="map" style="width: 80%; height: 60em;"></div>

    <!-- <table id="taulu">
            <thead>
                <tr>
                    <th>Aseman nimi</th>
                    <th>Vapaat pyörät</th>
                </tr>
            </thead>
            <tbody id="tiedot"></tbody>
        </table> -->
    <!-- <script src="testi.js"></script> -->
    <script type="module">
        var kartta = L.map('map');
            var merkki = null;
  
            function makeMap(x, y, name, available){
                kartta.setView([x, y], 16);
                if (name !== null){
                    if (merkki !== null){
                        kartta.removeLayer(merkki);
                    }
                    merkki = L.marker([x, y]).addTo(kartta)
                      .bindPopup("<h2>"+name+"</h2><p id='test'>Bikes available:</br>"
                        +available+"</p>").openPopup();
                } 
            }
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {attribution: `&copy:
             <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>
             contributors`
             }).addTo(kartta);

            import { getPyoraData, getStationData } from './exportesti.mjs';
            getPyoraData(makeMap);

            window.onload=function() {
                let drowDown = document.getElementById('asemat');
                drowDown.onchange=function() {
                    if (this.selectedIndex !== 0){
                        getStationData(this.options[this.selectedIndex].value, makeMap);
                    }
                } 
            }
        </script>

</body>

</html>